<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VizLearn - Causal Language Modeling</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;500;700&family=Inter:wght@300;400;600&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        brand: {
                            50: '#f0fdf4',
                            400: '#4ade80',
                            500: '#22c55e',
                            900: '#14532d',
                        }
                    },
                    animation: {
                        'grid-flow': 'grid-move 40s linear infinite',
                        'fade-in': 'fadeIn 0.5s ease-out forwards',
                        'cursor-blink': 'blink 1s infinite'
                    },
                    keyframes: {
                        'grid-move': {
                            '0%': { backgroundPosition: '0 0' },
                            '100%': { backgroundPosition: '40px 40px' },
                        },
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        blink: {
                            '0%, 50%': { opacity: '1' },
                            '51%, 100%': { opacity: '0' }
                        }
                    }
                }
            }
        }
    </script>
    <style>
        :root {
            --bg-body: #050505;
            --bg-surface: #0a0a0a;
            --bg-glass: rgba(10, 10, 10, 0.85);
            --border-subtle: rgba(74, 222, 128, 0.15); 
            --accent-primary: #4ade80;
            --accent-glow: rgba(74, 222, 128, 0.25);
            --text-main: #f0fdf4;
            --text-muted: #86efac;
            --card-bg: #0a0a0a;
            --input-bg: rgba(74, 222, 128, 0.03);
            --display-bg: rgba(0, 0, 0, 0.4);
            --grid-color: rgba(74, 222, 128, 0.05);
            --vignette-color: #050505;
            --stat-bg: rgba(0, 0, 0, 0.2);
            --stat-border: rgba(255, 255, 255, 0.05);
        }

        body.light-mode {
            --bg-body: #f0fdf4;
            --bg-surface: #ffffff;
            --bg-glass: rgba(255, 255, 255, 0.95);
            --border-subtle: rgba(22, 163, 74, 0.2);
            --accent-primary: #15803d; 
            --accent-glow: rgba(21, 128, 61, 0.15);
            --text-main: #111827; 
            --text-muted: #374151;
            --card-bg: #ffffff;
            --input-bg: rgba(0, 0, 0, 0.04);
            --display-bg: rgba(0, 0, 0, 0.03);
            --grid-color: rgba(0, 0, 0, 0.05);
            --vignette-color: transparent;
            --stat-bg: #f9fafb;
            --stat-border: #e5e7eb;
        }

        *, *::before, *::after {
            transition: background-color 300ms, border-color 300ms, color 300ms, box-shadow 300ms;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            background-image: 
                radial-gradient(circle at 50% 50%, transparent 0%, var(--vignette-color) 90%),
                linear-gradient(to right, var(--grid-color) 1px, transparent 1px),
                linear-gradient(to bottom, var(--grid-color) 1px, transparent 1px);
            background-size: 100% 100%, 40px 40px, 40px 40px;
            animation: grid-move 40s linear infinite;
        }

        h1, h2, h3, .brand-font {
            font-family: 'Space Grotesk', sans-serif;
            letter-spacing: -0.02em;
        }

        .mono-font {
            font-family: 'JetBrains Mono', monospace;
        }

        .glass-header {
            background-color: var(--bg-glass);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid var(--border-subtle);
        }

        .glass-card {
            border: 1px solid var(--border-subtle);
            background: var(--card-bg);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .glass-card:hover {
            border-color: var(--accent-primary);
        }

        .custom-textarea {
            background: var(--input-bg);
            border: 1px solid var(--border-subtle);
            color: var(--text-main);
            border-radius: 12px;
            padding: 1rem;
            width: 100%;
            outline: none;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.875rem;
            transition: border-color 0.2s;
        }
        .custom-textarea:focus {
            border-color: var(--accent-primary);
        }

        .action-btn {
            background: rgba(21, 128, 61, 0.1);
            border: 1px solid rgba(21, 128, 61, 0.2);
            color: var(--accent-primary);
            font-family: 'Space Grotesk', sans-serif;
            font-weight: 600;
            font-size: 0.75rem;
            text-transform: uppercase;
            padding: 0.75rem;
            border-radius: 8px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        .action-btn:hover:not(:disabled) {
            background: var(--accent-glow);
        }
        .action-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .stat-box {
            background: var(--stat-bg);
            border: 1px solid var(--stat-border);
            padding: 1rem;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .token-item {
            background: var(--input-bg);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 1rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.75rem;
            transition: all 0.2s;
        }
        .token-item:hover {
            background: var(--bg-glass);
            border-color: var(--accent-primary);
        }
        .token-item.selected {
            border-color: var(--accent-primary);
            background: var(--accent-glow);
            box-shadow: 0 0 15px var(--accent-glow);
        }
        .token-item.just-picked {
            background-color: var(--accent-primary) !important;
            color: white !important;
            transform: scale(1.02);
        }
        body.light-mode .token-item.just-picked {
            color: white !important;
        }

        .prob-bar {
            height: 4px;
            border-radius: 2px;
            background: var(--accent-primary);
            transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        input[type=range] {
            -webkit-appearance: none;
            background: transparent;
            width: 100%;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 18px;
            width: 18px;
            border-radius: 50%;
            background: #3b82f6;
            cursor: pointer;
            margin-top: -6px;
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 6px;
            background: var(--border-subtle);
            border-radius: 3px;
        }

        .scroll-container::-webkit-scrollbar {
            display: none;
        }
        
        .display-box {
            background: var(--display-bg);
            border-radius: 12px;
            padding: 1.5rem;
            min-height: 100px;
            max-height: 180px; /* Fixed Height to prevent layout shift */
            overflow-y: auto;
            line-height: 1.8;
            font-family: 'JetBrains Mono', monospace;
            border: 1px solid var(--border-subtle);
            color: var(--text-main);
        }

        select.custom-select {
            background: var(--input-bg);
            border: 1px solid var(--border-subtle);
            color: var(--text-main);
            padding: 0.5rem;
            border-radius: 8px;
            font-size: 0.8rem;
            width: 100%;
            outline: none;
        }
    
        /* Search Input Wrapper */
        .search-input-wrapper {
            background: var(--input-bg);
            border: 1px solid var(--border-subtle);
            position: relative;
        }
        .search-input-wrapper:focus-within {
            background: var(--input-focus-bg);
            border-color: var(--accent-primary);
            box-shadow: 0 0 15px var(--accent-glow);
        }
        .search-input-wrapper input {
            color: var(--text-main);
        }
        .search-input-wrapper input::placeholder {
            color: var(--text-muted);
            opacity: 0.7;
        }
        .search-input-wrapper i {
            color: var(--accent-primary);
            opacity: 0.7;
        }

        /* Dropdown Search */
        .search-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--card-bg);
            border: 1px solid var(--border-subtle);
            border-top: none;
            border-radius: 0 0 12px 12px;
            max-height: 400px;
            overflow-y: auto;
            z-index: 100;
            display: none;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
        }

        .search-dropdown.show {
            display: block;
            animation: slideDown 0.2s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .search-dropdown-item {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border-subtle);
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: space-between;
            color: inherit;
            text-decoration: none;
        }

        .search-dropdown-item:last-child {
            border-bottom: none;
        }

        .search-dropdown-item:hover {
            background: var(--input-focus-bg);
            padding-left: 20px;
        }

        .dropdown-item-title {
            font-weight: 500;
            color: var(--text-main);
        }

        .dropdown-item-path {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-left: 12px;
        }

        .dropdown-item-icon {
            color: var(--accent-primary);
            margin-right: 8px;
            font-size: 0.875rem;
        }

        .dropdown-no-results {
            padding: 20px 16px;
            text-align: center;
            color: var(--text-muted);
            font-size: 0.875rem;
        }

    </style>
</head>
<body class="flex flex-col min-h-screen overflow-x-hidden">

    <!-- Header -->
    <header class="glass-header sticky top-0 z-50">
        <div class="flex justify-center py-3 px-4 md:px-8">
            <div class="flex flex-col md:flex-row items-center justify-between w-full max-w-7xl gap-4">
                <!-- Logo -->
                <a href="../index.html" class="text-2xl font-bold flex-shrink-0 tracking-tight flex items-center gap-3 select-none cursor-pointer no-underline" style="color: var(--text-main)">
                    <div class="w-3 h-3 rounded-full bg-green-400 shadow-[0_0_15px_rgba(74,222,128,0.8)] animate-pulse"></div>
                    <span>viz<span style="color: var(--text-muted); font-weight: 300;">learn</span></span>
                </a>
                
                <!-- Search -->
                <div class="search-input-wrapper rounded-full flex items-center w-full max-w-md px-4 py-2.5 mx-auto md:mx-0">
                    <i class="fas fa-search text-sm"></i>
                    <input type="text" id="appSearchInput" aria-label="Search courses" placeholder="Search modules..." class="bg-transparent text-sm focus:outline-none ml-3 w-full font-sans tracking-wide">
                    <div id="searchDropdown" class="search-dropdown">
                        <!-- Results will be populated here -->
                    </div>
                </div>

                <!-- Theme Toggle + Back Button -->
                <div class="flex items-center gap-3">
                    <!-- Back to Hub Button -->
                    <a href="../index.html" class="hidden md:flex items-center gap-2 text-sm font-medium mono-font hover:text-green-400 transition-colors px-3 py-2 rounded-full" style="color: var(--text-muted)">
                        <i class="fas fa-arrow-left text-xs"></i>
                    </a>
                    
                    <!-- Theme Toggle -->
                    <button id="themeToggle" class="w-10 h-10 rounded-full flex items-center justify-center focus:outline-none transition-colors flex-shrink-0" style="color: var(--text-muted)" aria-label="Toggle Dark/Light Mode">
                        <i class="fas fa-sun hidden dark-icon"></i>
                        <i class="fas fa-moon hidden light-icon"></i>
                    </button>
                </div>
            </div>
        </div>
    </header>


    <main class="flex-1 p-4 md:p-8 w-full max-w-7xl mx-auto flex flex-col">
        
        <div class="mb-8 animate-fade-in">
            <div class="flex items-center gap-2 text-xs mono-font mb-2" style="color: var(--text-muted)">
                <span class="opacity-50">Modules</span>
                <span>/</span>
                <span class="opacity-50">NLP Generative</span>
                <span>/</span>
                <span style="color: var(--accent-primary)">CLM Lab</span>
            </div>
            <h1 class="text-3xl md:text-4xl font-bold brand-font" style="color: var(--text-main)">Probabilistic Causal Language Modeling</h1>
            <p class="mt-2 text-sm max-w-2xl" style="color: var(--text-muted)">
                Train a model on custom data and visualize how it predicts the next token based on learned probability distributions.
            </p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 h-full flex-1">
            
            <!-- Left Sidebar -->
            <aside class="lg:col-span-5 flex flex-col gap-6 animate-fade-in" style="animation-delay: 0.1s">
                
                <!-- Training Area -->
                <div class="glass-card p-6 flex flex-col gap-4">
                    <div class="flex justify-between items-center">
                        <h2 class="text-[10px] uppercase font-bold tracking-widest opacity-60">1. Dataset Training</h2>
                        <select id="sampleLoader" class="custom-select max-w-[150px]">
                            <option value="">Load Sample...</option>
                            <option value="ai">AI & ML Basics</option>
                            <option value="nature">Nature Description</option>
                            <option value="tech">Tech Support Logs</option>
                        </select>
                    </div>
                    <textarea id="corpusInput" rows="6" class="custom-textarea text-[10px]" placeholder="Add a large corpus here to train the model...">Machine learning is the study of computer algorithms that improve automatically through experience. Deep learning is a subset of machine learning based on artificial neural networks. Artificial intelligence is intelligence demonstrated by machines.</textarea>
                    <button id="trainBtn" class="action-btn bg-brand-400/10 border-brand-400/20 text-brand-400">
                        <i class="fas fa-brain"></i> Update learned Probabilities
                    </button>
                </div>

                <!-- Input Prompt -->
                <div class="glass-card p-6 flex flex-col gap-4">
                    <h2 class="text-[10px] uppercase font-bold tracking-widest opacity-60">2. Generation Settings</h2>
                    <div class="flex flex-col gap-2">
                         <span class="text-[9px] uppercase font-bold opacity-50">Input Prompt</span>
                         <input id="promptInput" class="custom-textarea text-xs py-2" value="Machine learning">
                    </div>
                    
                    <div>
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-[10px] uppercase font-bold opacity-60">Temperature (Randomness)</span>
                            <span id="tempVal" class="text-xs font-bold text-blue-500">0.1</span>
                        </div>
                        <input type="range" id="tempSlider" min="0.1" max="1.5" step="0.1" value="0.1">
                    </div>

                    <div class="grid grid-cols-2 gap-3 pt-2">
                        <button id="nextBtn" class="action-btn">
                            <i class="fas fa-step-forward"></i> Generate
                        </button>
                        <button id="resetBtn" class="action-btn bg-red-500/10 border-red-500/20 text-red-500">
                            <i class="fas fa-undo"></i> Reset
                        </button>
                    </div>
                </div>

                <!-- Statistics -->
                <div class="glass-card p-6">
                    <h2 class="text-[10px] uppercase font-bold tracking-widest opacity-60 mb-4">Training Statistics</h2>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="stat-box text-center">
                            <span class="text-[9px] uppercase font-bold opacity-50">Vocabulary Size</span>
                            <span id="statVocab" class="text-xl font-bold text-brand-500">0</span>
                        </div>
                        <div class="stat-box text-center">
                            <span class="text-[9px] uppercase font-bold opacity-50">Training Tokens</span>
                            <span id="statTokens" class="text-xl font-bold">0</span>
                        </div>
                        <div class="stat-box text-center">
                            <span class="text-[9px] uppercase font-bold opacity-50">Current Context</span>
                            <span id="statContext" class="text-xl font-bold">0</span>
                        </div>
                        <div class="stat-box text-center">
                            <span class="text-[9px] uppercase font-bold opacity-50">Max Prediction</span>
                            <span id="statConf" class="text-xl font-bold">0%</span>
                        </div>
                    </div>
                </div>
            </aside>

            <!-- Right Visualization Area -->
            <section class="lg:col-span-7 flex flex-col gap-6 animate-fade-in" style="animation-delay: 0.2s">
                <div class="glass-card flex-1 flex flex-col p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-[10px] uppercase font-bold tracking-widest opacity-60">Generated Output</h2>
                        <span id="tokenLabel" class="text-[10px] font-bold px-2 py-1 rounded bg-brand-400/10 text-brand-400 border border-brand-400/20 mono-font">LIVE INFERENCE</span>
                    </div>

                    <div id="sequenceDisplay" class="display-box mb-6 scroll-container">
                        <span id="promptDisplay" class="opacity-60 italic"></span>
                        <span id="generatedText" class="text-brand-400 font-bold"></span>
                        <span class="animate-cursor-blink text-brand-400 ml-1">|</span>
                    </div>

                    <h2 class="text-[10px] uppercase font-bold tracking-widest opacity-60 mb-4">Next Token learned Distribution</h2>
                    <div id="predictionList" class="scroll-container overflow-y-auto flex-grow h-[320px] bg-black/5 rounded-xl p-4 border border-dashed border-white/5">
                        <div class="h-full flex items-center justify-center opacity-30 text-xs italic">
                            Generate next token to see probabilities
                        </div>
                    </div>

                    <div class="mt-6 pt-4 border-t border-white/5">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-[10px] uppercase font-bold opacity-60">Distribution Scroll</span>
                            <span class="text-[10px] uppercase font-bold text-blue-500">View</span>
                        </div>
                        <input type="range" id="scrollSlider" min="0" max="100" value="0">
                    </div>
                </div>
            </section>
        </div>
    </main>

    <footer class="w-full py-6 mt-8 border-t border-brand-400/10">
        <div class="container mx-auto px-6 text-center">
            <div class="flex justify-center items-center space-x-6 mb-4" style="color: var(--text-muted)">
                <a href="https://github.com/AshishJangra27" target="_blank" class="hover:text-green-500 transition-colors"><i class="fab fa-github fa-lg"></i></a>
                <a href="https://www.linkedin.com/in/ashish-jangra/" target="_blank" class="hover:text-green-500 transition-colors"><i class="fab fa-linkedin fa-lg"></i></a>
                <a href="https://www.kaggle.com/ashishjangra27" target="_blank" class="hover:text-green-500 transition-colors"><i class="fab fa-kaggle fa-lg"></i></a>
                <a href="https://www.instagram.com/ashish_zangra/" target="_blank" class="hover:text-green-500 transition-colors"><i class="fab fa-instagram fa-lg"></i></a>
            </div>
            <p class="text-[10px] tracking-[0.2em] mono-font uppercase opacity-60">&copy; 2025 VIZLEARN // CLM INTERACTIVE LAB</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Theme toggle logic
            const themeToggleBtn = document.getElementById('themeToggle');
            const sunIcon = themeToggleBtn.querySelector('.dark-icon');
            const moonIcon = themeToggleBtn.querySelector('.light-icon');
            let currentTheme = localStorage.getItem('theme') || 'dark';

            function applyTheme(theme) {
                if (theme === 'light') {
                    document.body.classList.add('light-mode');
                    moonIcon.classList.remove('hidden');
                    sunIcon.classList.add('hidden');
                } else {
                    document.body.classList.remove('light-mode');
                    sunIcon.classList.remove('hidden');
                    moonIcon.classList.add('hidden');
                }
            }
            themeToggleBtn.addEventListener('click', () => {
                currentTheme = currentTheme === 'light' ? 'dark' : 'light';
                localStorage.setItem('theme', currentTheme);
                applyTheme(currentTheme);
            });
            applyTheme(currentTheme);

            // --- CLM Probabilistic Engine ---
            let transitionMatrix = {};
            let vocabulary = new Set();
            let generatedTokens = [];
            let temperature = 0.1; // Default Temperature to Minimum

            const corpusInput = document.getElementById('corpusInput');
            const promptInput = document.getElementById('promptInput');
            const nextBtn = document.getElementById('nextBtn');
            const trainBtn = document.getElementById('trainBtn');
            const resetBtn = document.getElementById('resetBtn');
            const sampleLoader = document.getElementById('sampleLoader');
            
            const sequenceDisplay = document.getElementById('sequenceDisplay');
            const promptDisplay = document.getElementById('promptDisplay');
            const generatedTextEl = document.getElementById('generatedText');
            const predictionList = document.getElementById('predictionList');
            const scrollSlider = document.getElementById('scrollSlider');
            const tempSlider = document.getElementById('tempSlider');
            const tempValDisplay = document.getElementById('tempVal');
            
            const statVocab = document.getElementById('statVocab');
            const statTokens = document.getElementById('statTokens');
            const statContext = document.getElementById('statContext');
            const statConf = document.getElementById('statConf');

            const SAMPLES = {
                ai: "Artificial intelligence is intelligence demonstrated by machines, as opposed to natural intelligence displayed by animals and humans. AI research has been defined as the field of study of intelligent agents, which are any system that perceives its environment and takes actions that maximize its chance of achieving its goals. Machine learning is a field of inquiry devoted to understanding and building methods that 'learn', that is, methods that leverage data to improve performance on some set of tasks.",
                nature: "The forest was deep and dark, but the light of the moon guided us through the narrow path. The trees were tall like giants guarding a secret kingdom. The air was cool and smelled of fresh pine and damp earth. Far in the distance, we could hear the rushing water of the river hitting the stones.",
                tech: "Error 404: Page not found on server. Please check the network connectivity and try restarting the browser application. System logs indicate a timeout in the database connection module. Database is currently undergoing maintenance. Update to version 2.4 to resolve compatibility issues with the cloud storage provider."
            };

            function tokenize(text) {
                return text.toLowerCase()
                           .replace(/[^\w\s]/g, ' ')
                           .split(/\s+/)
                           .filter(t => t.length > 0);
            }

            function trainModel() {
                const text = corpusInput.value;
                const tokens = tokenize(text);
                
                transitionMatrix = {};
                vocabulary = new Set(tokens);

                for (let i = 0; i < tokens.length - 1; i++) {
                    const current = tokens[i];
                    const next = tokens[i+1];
                    if (!transitionMatrix[current]) transitionMatrix[current] = {};
                    transitionMatrix[current][next] = (transitionMatrix[current][next] || 0) + 1;
                }

                statVocab.textContent = vocabulary.size;
                statTokens.textContent = tokens.length;
                generatePredictions();
            }

            function softmax(scores) {
                const exps = scores.map(s => Math.exp(s / temperature));
                const sum = exps.reduce((a, b) => a + b, 0);
                return exps.map(e => e / sum);
            }

            function generatePredictions(highlightedToken = null) {
                const currentFullText = (promptInput.value + ' ' + generatedTokens.join(' ')).trim();
                const tokens = tokenize(currentFullText);
                const lastToken = tokens[tokens.length - 1];

                let candidates = [];
                let rawCounts = [];

                if (transitionMatrix[lastToken]) {
                    const entries = Object.entries(transitionMatrix[lastToken]);
                    entries.forEach(([token, count]) => {
                        candidates.push(token);
                        rawCounts.push(count);
                    });
                }

                if (candidates.length < 5) {
                    const vocabArray = Array.from(vocabulary);
                    for (let i = 0; i < 15; i++) {
                        const randomToken = vocabArray[Math.floor(Math.random() * vocabArray.length)];
                        if (!candidates.includes(randomToken)) {
                            candidates.push(randomToken);
                            rawCounts.push(0.05); 
                        }
                    }
                }

                const probs = softmax(rawCounts);
                const results = candidates.map((token, i) => ({
                    token, prob: probs[i]
                })).sort((a, b) => b.prob - a.prob).slice(0, 15);

                renderPredictions(results, highlightedToken);
                return results;
            }

            function renderPredictions(predictions, highlightedToken = null) {
                predictionList.innerHTML = '';
                if (predictions.length === 0) return;

                predictions.forEach((p, idx) => {
                    const item = document.createElement('div');
                    const isTop = idx === 0;
                    const isActualPick = highlightedToken && p.token === highlightedToken;
                    
                    item.className = `token-item ${isTop ? 'selected' : ''} ${isActualPick ? 'just-picked' : ''}`;
                    const width = p.prob * 100;
                    
                    item.innerHTML = `
                        <div class="flex-grow">
                            <div class="flex justify-between mb-1">
                                <span class="text-xs font-bold mono-font">${p.token}</span>
                                <span class="text-[10px] opacity-40">${(p.prob * 100).toFixed(1)}%</span>
                            </div>
                            <div class="w-full bg-white/5 h-1 rounded-full overflow-hidden">
                                <div class="prob-bar" style="width: ${width}%"></div>
                            </div>
                        </div>
                    `;
                    predictionList.appendChild(item);
                });

                statConf.textContent = Math.round(predictions[0].prob * 100) + '%';

                setTimeout(() => {
                    const max = predictionList.scrollHeight - predictionList.clientHeight;
                    scrollSlider.max = max > 0 ? max : 0;
                    scrollSlider.value = 0;
                }, 50);
            }

            async function generateNext() {
                nextBtn.disabled = true;
                const predictions = generatePredictions();
                if (predictions.length === 0) {
                    nextBtn.disabled = false;
                    return;
                }

                const rand = Math.random();
                let cumulative = 0;
                let selected = predictions[0];
                
                for (const p of predictions) {
                    cumulative += p.prob;
                    if (rand <= cumulative) {
                        selected = p;
                        break;
                    }
                }

                renderPredictions(predictions, selected.token);
                await new Promise(r => setTimeout(r, 250));

                generatedTokens.push(selected.token);
                promptDisplay.textContent = promptInput.value;
                generatedTextEl.textContent = ' ' + generatedTokens.join(' ');
                
                sequenceDisplay.scrollTop = sequenceDisplay.scrollHeight;
                statContext.textContent = tokenize(promptInput.value + ' ' + generatedTokens.join(' ')).length;
                
                generatePredictions();
                nextBtn.disabled = false;
            }

            trainBtn.addEventListener('click', trainModel);
            nextBtn.addEventListener('click', generateNext);
            
            sampleLoader.addEventListener('change', (e) => {
                if (e.target.value && SAMPLES[e.target.value]) {
                    corpusInput.value = SAMPLES[e.target.value];
                    trainModel();
                }
            });

            resetBtn.addEventListener('click', () => {
                generatedTokens = [];
                generatedTextEl.textContent = '';
                statContext.textContent = tokenize(promptInput.value).length;
                generatePredictions();
            });

            promptInput.addEventListener('input', () => {
                promptDisplay.textContent = promptInput.value;
                generatedTokens = [];
                generatedTextEl.textContent = '';
                generatePredictions();
            });

            tempSlider.addEventListener('input', (e) => {
                temperature = parseFloat(e.target.value);
                tempValDisplay.textContent = temperature.toFixed(1);
                generatePredictions();
            });

            scrollSlider.addEventListener('input', (e) => {
                predictionList.scrollTop = e.target.value;
            });

            predictionList.addEventListener('scroll', () => {
                scrollSlider.value = predictionList.scrollTop;
            });

            trainModel();
            promptDisplay.textContent = promptInput.value;
        });
    
        // ===== DROPDOWN SEARCH FUNCTIONALITY =====
        const allCourses = [
            // Machine Learning
            { title: "Confusion Matrix", path: "../machine_learning/confusion_matrix.html", category: "ml", icon: "fa-brain" },
            { title: "Cosine Similarity", path: "../machine_learning/cosine_similarity.html", category: "ml", icon: "fa-brain" },
            { title: "Cross Validation", path: "../machine_learning/cross_validation.html", category: "ml", icon: "fa-brain" },
            { title: "Decision Tree", path: "../machine_learning/decision_tree.html", category: "ml", icon: "fa-brain" },
            { title: "K-Means", path: "../machine_learning/k_means.html", category: "ml", icon: "fa-brain" },
            { title: "KNN", path: "../machine_learning/knn.html", category: "ml", icon: "fa-brain" },
            { title: "Label Encoding", path: "../machine_learning/label_encoding.html", category: "ml", icon: "fa-brain" },
            { title: "Linear Regression OLS", path: "../machine_learning/linear_regression_with_ols.html", category: "ml", icon: "fa-brain" },
            { title: "Naive Bayes", path: "../machine_learning/naive_bayes.html", category: "ml", icon: "fa-brain" },
            { title: "One Hot Encoding", path: "../machine_learning/one_hot_encoding.html", category: "ml", icon: "fa-brain" },
            { title: "Sliding Window Time Series", path: "../machine_learning/sliding_window_for_timeseries_data.html", category: "ml", icon: "fa-brain" },
            { title: "SVM", path: "../machine_learning/svm.html", category: "ml", icon: "fa-brain" },
            { title: "Train Test Split", path: "../machine_learning/train_test_split.html", category: "ml", icon: "fa-brain" },
            
            // Deep Learning
            { title: "Activation Functions", path: "../deep_learning/activation_functions.html", category: "dl", icon: "fa-network-wired" },
            { title: "Batch Processing in Neural Networks", path: "../deep_learning/batch_processing_in_neural_networks.html", category: "dl", icon: "fa-network-wired" },
            { title: "Dropout in Neural Networks", path: "../deep_learning/dropout_in_neural_networks.html", category: "dl", icon: "fa-network-wired" },
            { title: "Gradient Descent Batch Processing", path: "../deep_learning/gradient_descent_batch_processing.html", category: "dl", icon: "fa-network-wired" },
            { title: "Gradient Descent Training", path: "../deep_learning/gradient_descent_training.html", category: "dl", icon: "fa-network-wired" },
            { title: "Linear Regression with Gradient Descent", path: "../deep_learning/linear_regression_with_gradient_descent.html", category: "dl", icon: "fa-network-wired" },
            { title: "Neural Network", path: "../deep_learning/neural_network.html", category: "dl", icon: "fa-network-wired" },
            { title: "Perceptron", path: "../deep_learning/perceptron.html", category: "dl", icon: "fa-network-wired" },
            
            // DSA
            { title: "A* Algorithm", path: "../dsa/a_star.html", category: "dsa", icon: "fa-layer-group" },
            { title: "Backtracking", path: "../dsa/backtracking.html", category: "dsa", icon: "fa-layer-group" },
            { title: "Binary Search", path: "../dsa/binary_search.html", category: "dsa", icon: "fa-layer-group" },
            { title: "Breadth First Search", path: "../dsa/breadth_first_search.html", category: "dsa", icon: "fa-layer-group" },
            { title: "Bubble Sort", path: "../dsa/bubble_sort.html", category: "dsa", icon: "fa-layer-group" },
            { title: "Counting Sort", path: "../dsa/counting_sort.html", category: "dsa", icon: "fa-layer-group" },
            { title: "Depth First Search", path: "../dsa/depth_first_search.html", category: "dsa", icon: "fa-layer-group" },
            { title: "Dictionaries in Python", path: "../dsa/dictionaries_in_python.html", category: "dsa", icon: "fa-layer-group" },
            { title: "Dijkstra's Algorithm", path: "../dsa/dijkstra's.html", category: "dsa", icon: "fa-layer-group" },
            { title: "Fibonacci Search", path: "../dsa/fibonacci_search.html", category: "dsa", icon: "fa-layer-group" },
            { title: "Insertion Sort", path: "../dsa/insertion_sort.html", category: "dsa", icon: "fa-layer-group" },
            { title: "Interpolation Search", path: "../dsa/interpolation_search.html", category: "dsa", icon: "fa-layer-group" },
            { title: "Linear Search", path: "../dsa/linear_search.html", category: "dsa", icon: "fa-layer-group" },
            { title: "Lists in Python", path: "../dsa/lists_in_python.html", category: "dsa", icon: "fa-layer-group" },
            { title: "Merge Sort", path: "../dsa/merge_sort.html", category: "dsa", icon: "fa-layer-group" },
            { title: "Quick Sort", path: "../dsa/quick_sort.html", category: "dsa", icon: "fa-layer-group" },
            { title: "Selection Sort", path: "../dsa/selection_sort.html", category: "dsa", icon: "fa-layer-group" },
            { title: "Strings in Python", path: "../dsa/strings_in_python.html", category: "dsa", icon: "fa-layer-group" },
            
            // Natural Language Processing
            { title: "ASCII Codes", path: "../natural_language_processing/ascii_codes.html", category: "nlp", icon: "fa-comments" },
            { title: "N-Gram", path: "../natural_language_processing/n_gram.html", category: "nlp", icon: "fa-comments" },
            { title: "Stemming vs Lemmatization", path: "../natural_language_processing/stemming_vs_lemmatization.html", category: "nlp", icon: "fa-comments" },
            { title: "Text Normalization Pipeline", path: "../natural_language_processing/text_normalization_pipeline.html", category: "nlp", icon: "fa-comments" },
            { title: "Tokenization", path: "../natural_language_processing/tokenization.html", category: "nlp", icon: "fa-comments" },
            { title: "Word Cloud", path: "../natural_language_processing/word_cloud.html", category: "nlp", icon: "fa-comments" },
            
            // Computer Vision
            { title: "Downsampling in CNN", path: "../computer_vision/downsampling_in_cnn.html", category: "vision", icon: "fa-eye" },
            { title: "Edge Detection", path: "../computer_vision/edge_detection.html", category: "vision", icon: "fa-eye" },
            { title: "Feature Map in CNN", path: "../computer_vision/feature_map_in_cnn.html", category: "vision", icon: "fa-eye" },
            { title: "Grayscale Image Processing", path: "../computer_vision/grayscale_image_processing.html", category: "vision", icon: "fa-eye" },
            { title: "Image Data Augmentation", path: "../computer_vision/image_data_augmentation.html", category: "vision", icon: "fa-eye" },
            { title: "RGB Image Processing", path: "../computer_vision/rgb_image_processing.html", category: "vision", icon: "fa-eye" },
            
            // Database
            { title: "Groupby in SQL", path: "../database/groupby_in_sql.html", category: "db", icon: "fa-database" },
            { title: "Joins in SQL", path: "../database/joins_in_sql.html", category: "db", icon: "fa-database" },
            { title: "Window Functions in SQL", path: "../database/window_functions_in_sql.html", category: "db", icon: "fa-database" },
            
            // Gen AI
            { title: "Casual Language Modeling", path: "../gen_ai/casual_language_modeling.html", category: "gen-ai", icon: "fa-wand-magic-sparkles" },
            
            // Maths
            { title: "Equation of Line", path: "../maths/equation_of_line.html", category: "maths", icon: "fa-calculator" }
        ];

        // Initialize search functionality
        const searchInput = document.getElementById('appSearchInput');
        const dropdown = document.getElementById('searchDropdown');

        if (searchInput) {
            searchInput.addEventListener('input', (e) => {
                const query = e.target.value.toLowerCase().trim();
                
                if (query.length === 0) {
                    dropdown.classList.remove('show');
                    return;
                }

                // Filter courses
                const filtered = allCourses.filter(course => 
                    course.title.toLowerCase().includes(query) || 
                    course.category.toLowerCase().includes(query)
                );

                // Render results
                if (filtered.length === 0) {
                    dropdown.innerHTML = '<div class="dropdown-no-results">No courses found</div>';
                } else {
                    dropdown.innerHTML = filtered.map(course => `
                        <a href="${course.path}" class="search-dropdown-item" style="text-decoration: none;">
                            <div style="display: flex; align-items: center;">
                                <i class="fas ${course.icon} dropdown-item-icon"></i>
                                <div>
                                    <div class="dropdown-item-title">${course.title}</div>
                                    <div class="dropdown-item-path">${course.category.toUpperCase()}</div>
                                </div>
                            </div>
                            <i class="fas fa-arrow-right" style="color: var(--accent-primary); opacity: 0.5;"></i>
                        </a>
                    `).join('');
                }

                dropdown.classList.add('show');
            });

            // Close dropdown when clicking outside
            document.addEventListener('click', (e) => {
                if (!searchInput.parentElement.contains(e.target)) {
                    dropdown.classList.remove('show');
                }
            });

            // Close dropdown on Escape key
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    dropdown.classList.remove('show');
                }
            });
        }

    </script>
</body>
</html>